## 面向对象设计与构造第二单元第三次作业指导书

***

### 第一部分：训练目标

本次作业的基本目标是模拟**多线程实时电梯系统**，在前两次作业的基础上，掌握线程之间的交互，强化线程之间的协同设计层次架构

***

### 第二部分：基本概念

- $1、$电梯系统时间 $T_{real}$：从程序开始运行，到所有线程终止，程序结束的时刻花费的时间，即程序的真实运行时间 (real time)
- $2、$电梯系统运行花费总时间 $T_{final}$：从程序开始运行，到电梯最后输出关门的时刻花费的时间
- $3、$开关门窗口时间：从电梯开始开门的时刻到完成关门的时刻的时间闭区间
- $4、$数据基本限制：所有测试数据均需满足的限制
- $5、$公测数据限制：中测和强测数据满足的限制
- $6、$互测数据限制：互测数据需满足的限制

***

### 第三部分：题目描述

#### 一、电梯系统说明

本次作业需要模拟一个多线程环形实时电梯系统。

系统基于一个类似北京航空航天大学新主楼的大楼，大楼有 $A,B,C,D,E$ 五个座，每个楼座可以对应多台电梯，可以在楼座内 $1-10$​​ 层之间运行。**本次作业将扩大乘客的移动需求**，每个乘客的起始位置和目的位置可以在楼层和楼座上都不同。同时，**本次作业新增电梯定制化功能**，对纵向电梯的运行速度、可容纳人数，横向电梯的运行速度、可容纳人数、可开关门信息进行**定制**。

系统从标准输入中输入请求信息，程序进行接收和处理，模拟电梯运行，将必要的运行信息通过输出接口进行输出。

具体而言，本次作业电梯系统具有的功能为：

* $1、$楼座对应的电梯：上下行，开关门，以及模拟乘客的进出。
* $2、$楼层对应的电梯：左右行，开关门，以及模拟乘客的进出。

电梯系统**可以采用任意的调度策略**，即在任意时刻，系统选择上下（左右）行动，是否在某层开关门，都可自定义，只要保证在**电梯系统时间不超过系统时间上限**的前提下将所有的乘客送至目的地即可。

电梯每纵向（横向）运行一层（座）、开关门的时间为固定值，仅在**开关门窗口时间内允许乘客进出**。

**电梯系统默认初始在 $A,B,C,D,E$ 五个楼座的 $1$ 层中有一个容量为 $8$ 人，运行速度为 $0.6$​ s/层的纵向电梯。**

**电梯系统默认初始在 $A$​ 座的 $1$​ 层中有一个容量为 $8$​ 人，运行速度为 $0.6$​ s/座，可以在全部楼座停留的横向电梯。**

#### 二、电梯参数说明

- $1、$可到达楼层：1-10层
- $2、$纵向电梯初始位置：各座1层
- $3、$横向电梯初始位置：A 座各层 
- $4、$数量：最初5部纵向电梯、1部横向电梯，可增加
- $5、$编号：最初5部电梯中 A 座为1号，B座为2号，依次类推，最初的横向电梯为6号；新增的电梯编号自定义，但不可与之前的重复
- $6、$移动一层（座）花费的时间：可定制
- $7、$开门花费的时间：0.2s
- $8、$关门花费的时间：0.2s
- $9、$限乘人数：可定制
- $10、$横向电梯可停靠楼层：可定制

#### 三、电梯请求说明

本次作业的电梯，为一种比较特殊的电梯，学名叫做**目的选择电梯**。

大概意思是，**在电梯的每个入口，都有一个输入装置，让每个乘客输入自己的目的位置**。电梯基于这样的一个目的地选择系统进行调度，将乘客运送到指定的目标位置。

所以，一个电梯请求包含这个人的**出发楼座、出发楼层、目的楼座和目的楼层**，以及这个人的id（保证人员id唯一），请求内容将作为一个整体送入电梯系统，在整个运行过程中请求内容不会发生改变。

#### 四、电梯捎带规则说明

在**不违反课程规则**的前提下，我们对电梯的**捎带策略不做限制**。希望同学们多多阅读并自行探索相关算法，对电梯的捎带策略有自己的设计与思考。

为保证同学们实现的都为作业要求的**可捎带电梯**，我们对电梯的性能做一定的约束，采用**类似ALS调度策略**为性能**基准**（关于调度策略，欢迎大家积极上网找资料探索）。性能约束详见公测说明-正确性判断章节中关于 $T_{max}$ 的部分。

#### 五、基准策略

+ $1、$对于纵向电梯，采用 ALS 策略

+ $2、$对于横向电梯，采用基于 ALS 的不支持换乘策略

  + $(1)、$**目标方向**为能够完成这个请求的最短路线所走的方向，比如 $A$ 座到 $C$ 座采用$A \rightarrow B \rightarrow C$ 的策略，$A$ 座到 $E$ 座采用   $A\rightarrow E$ 的策略
  + $(2)、$分为**主请求**和**被捎带请求**两个概念

  + $(3)、$主请求选择规则：

    - $a、$如果电梯中没有乘客，将请求队列中到达时间最早的请求作为主请求

    - $b、$如果电梯中有乘客，将其中到达时间最早的乘客请求作为主请求

  - $(4)、$被捎带请求选择规则：

    - $a、$电梯的主请求存在

    - $b、$该请求投喂的时刻**小于等于**电梯到达该请求出发楼层关门的截止时间

    - $c、$电梯主请求的目标方向和该请求的目标方向一致

  + $(5)、$每个横向电梯所处理的乘客的请求符合如下条件，请求的起始楼座为 $P$，目的楼座为 $Q$，电梯的可开关门信息为 $M$，有如下公式：

    `((M >> (P -'A')) & 1) + ((M >> (Q -'A')) & 1) == 2`
    
    关于这个公式，可以参照**提示与警示**中有关掩码的介绍

+ $3、$每次运送时先由起始楼座纵向电梯把乘客运送到中转楼层，在中转楼层经横向电梯运输到目的楼座后，再由目的楼座纵向电梯运送到目的楼层。

  + $(1)、$乘客的起始楼座为 $P$，目的楼座为 $Q$，起始楼层为 $X$,  目的楼层为 $Y$，则中转楼层 $m$ 满足如下公式：
  
    存在`((M >> (P -'A')) & 1) + ((M >> (Q -'A')) & 1) == 2` 且使 $|X-m| + |Y-m|$ 最小的 $m$
  
  + $M$ 是中转楼层的某一个电梯的可开关门信息，关于公式的详细信息参见第四部分关于输入数据的描述。
  
+ $4、$在电梯的调度上，采用一种较为均衡的调度方式，例如 $A$ 座 $7$ 层有5个乘客，3部电梯，那么第1个乘客分配给第1部电梯，第2个乘客分配给第2部电梯，第3个乘客分配给第3部电梯，第4个乘客分配给第1部电梯，第5个乘客分配给第2部电梯

***

### 第四部分：输入/输出和样例

#### 一、输入输出接口说明

- $1、$本单元作业使用官方提供的输入输出接口进行输入输出。
- $2、$输入接口提供了若干方法，通过调用方法可以直接获取所需数据对象。输入接口在**尝试**读取标准输入的内容时，对于正确的输入将成功解析，错误的则输出错误信息，但不会影响程序的正常运行。
- $3、$输出子程序接受一个字符串，并附上时间戳后再输出。
- $4、$详细的接口定义和使用方法见官方接口说明文档。
- $5、$程序的输入输出为**实时交互**，评测机可以做到在某个时间点投放一定量的输入。

#### 二、输入数据

* $1、$每行输入数据可分以下三类：

  * $(1)、$请求信息：
    * $a、$格式为：`[时间戳]乘客ID-FROM-起点座-起点层-TO-终点座-终点层`
    * $b、$输入保证 $[$起点座 $==$ 终点座$] + [$起点层 $==$ 终点层$ ]\ \ne 2$，即楼座和楼层不会同时相同。
    * $c、$乘客 $ID$ 唯一，且满足$ID$是 int 类型数据
  * $(2)、$为一个楼座动态增加纵向电梯的指令：
    * $a、$格式为：`ADD-building-电梯ID-楼座ID-容纳人数V1-运行速度V2`
    * $b、$输入保证楼座 $ID \in [A,B,C,D,E]$
    * $c、$电梯 $ID$ 唯一
    * $d、$新建电梯默认处于对应楼座 $1$ 层
    * $e、$输入保证容纳人数 $V1 \in [4,6,8]$
    * $f、$输入保证运行速度 $V2 \in [0.2, 0.4, 0.6]$
  * $(3)、$为一个楼层动态增加横向电梯的指令：
    * $a、$格式为：`ADD-floor-电梯ID-楼层ID-容纳人数V1-运行速度V2-可开关门信息M`
    * $b、$若满足 `((M >> (X-'A')) & 1) == 1` ，则代表该电梯在楼座 $X$ 可开关门。$(X \in [A,B,C,D,E])$
    * $c、$输入保证 $\sum_{i=0}^4 ((M >> i)\  \&\  1) \ge 2$，即至少有两个可到达楼座。
    * $d、$输入同时保证 $1 \lt M \lt 32$，即不包含无意义的二进制位。
    * $e、$输入保证楼层 $ID \in [1,2,3,4,5,6,7,8,9,10]$
    * $f、$电梯 $ID$ 唯一
    * $g、$新建电梯默认处于对应楼层 $A$ 座
    * $h、$输入保证容纳人数$V1 \in [4,6,8]$
    * $i、$输入保证运行速度$V2 \in [0.2, 0.4, 0.6]$

#### 三、输出数据

- $1、$通过调用输出接口的每一次输出将自动附加时间戳于头部，具体请参考**输出接口文档**，请不要试图伪造时间戳，否则会在实际评测时产生不一样的结果导致程序运行错误。

- $2、$电梯到达某一位置：`[时间戳]ARRIVE-所在座-所在层-电梯ID`

    > **每到达一个楼层都要输出，初始所在的楼层不需要输出**

- $3、$电梯**开始**开门：`[时间戳]OPEN-所在座-所在层-电梯ID`

- $4、$电梯**完成**关门：`[时间戳]CLOSE-所在座-所在层-电梯ID`

- $5、$乘客进入电梯：`[时间戳]IN-乘客ID-所在座-所在层-电梯ID`

- $6、$乘客离开电梯：`[时间戳]OUT-乘客ID-所在座-所在层-电梯ID`

#### 四、样例

<table>
    <tr>
        <td>#</td>
        <td>输入</td>
        <td>输出</td>
        <td>说明</td>
    </tr>
    <tr>
        <td width = "100px">1</td>
        <td width = "300px">[2.0]ADD-floor-7-3-6-0.4-5 <br />
							[2.3]1-FROM-A-4-TO-C-3</td>
        <td width = "300px">[   2.8160]ARRIVE-A-2-1 <br />
                            [   3.4290]ARRIVE-A-3-1 <br />
                            [   4.0370]ARRIVE-A-4-1 <br />
                            [   4.0380]OPEN-A-4-1 <br />
                            [   4.2570]IN-1-A-4-1 <br />
                            [   4.4600]CLOSE-A-4-1 <br />
                            [   5.0710]ARRIVE-A-3-1 <br />
                            [   5.0720]OPEN-A-3-1 <br /> 
                            [   5.2910]OUT-1-A-3-1 <br />
                            [   5.4960]CLOSE-A-3-1 <br />
                            [   5.4970]OPEN-A-3-7 <br />
                            [   5.7070]IN-1-A-3-7 <br />
                            [   5.9240]CLOSE-A-3-7 <br />
                            [   6.3270]ARRIVE-B-3-7 <br />
                            [   6.7370]ARRIVE-C-3-7 <br />
                            [   6.7380]OPEN-C-3-7 <br />
                            [   6.9400]OUT-1-C-3-7 <br />
                            [   7.1600]CLOSE-C-3-7</td>
        <td width = "260px">新加入的电梯(ID为7)可停靠信息为5，代表可以在 A 座和 C 座停留</td>
    </tr>
    <tr>
        <td>2</td>
        <td>[2.0]ADD-floor-7-3-6-0.4-3<br />
            [2.3]1-FROM-A-4-TO-C-3</td>
        <td>[   2.8130]ARRIVE-A-2-1<br />
            [   3.4240]ARRIVE-A-3-1<br />
            [   4.0330]ARRIVE-A-4-1<br />
            [   4.0350]OPEN-A-4-1<br />
            [   4.2510]IN-1-A-4-1<br />
            [   4.4690]CLOSE-A-4-1<br />
            [   5.0800]ARRIVE-A-3-1<br />
            [   5.6940]ARRIVE-A-2-1<br />
            [   6.2980]ARRIVE-A-1-1<br />
            [   6.3010]OPEN-A-1-1<br />
            [   6.5220]OUT-1-A-1-1<br />
            [   6.7340]CLOSE-A-1-1<br />
            [   6.7360]OPEN-A-1-6<br />
            [   6.9430]IN-1-A-1-6<br />
            [   7.1560]CLOSE-A-1-6<br />
            [   7.7630]ARRIVE-B-1-6<br />
            [   8.3850]ARRIVE-C-1-6<br />
            [   8.3860]OPEN-C-1-6<br />
            [   8.6030]OUT-1-C-1-6<br />
            [   8.8100]CLOSE-C-1-6<br />
            [   8.8110]OPEN-C-1-3<br />
            [   9.0190]IN-1-C-1-3<br />
            [   9.2330]CLOSE-C-1-3<br />
            [   9.8340]ARRIVE-C-2-3<br />
            [  10.4410]ARRIVE-C-3-3<br />
            [  10.4410]OPEN-C-3-3<br />
            [  10.6560]OUT-1-C-3-3<br />
            [  10.8690]CLOSE-C-3-3</td>
        <td>新加入的电梯(ID为7)可停靠信息为3，代表可以在A座和B座停留，因此乘客只能在1层换乘</td>
    </tr>
    <tr>
        <td>3</td>
        <td>[1.0]ADD-floor-7-7-4-0.6-31<br />
            [3.4]1-FROM-A-8-TO-C-7<br />
            [4.4]2-FROM-B-7-TO-D-8</td>
        <td>[   3.9130]ARRIVE-A-2-1<br />
            [   4.5230]ARRIVE-A-3-1<br />
            [   4.9190]ARRIVE-B-7-7<br />
            [   4.9210]OPEN-B-7-7<br />
            [   5.1360]ARRIVE-A-4-1<br />
            [   5.1370]IN-2-B-7-7<br />
            [   5.3510]CLOSE-B-7-7<br />
            [   5.7510]ARRIVE-A-5-1<br />
            [   5.9540]ARRIVE-C-7-7<br />
            [   6.3530]ARRIVE-A-6-1<br />
            [   6.5690]ARRIVE-D-7-7<br />
            [   6.5710]OPEN-D-7-7<br />
            [   6.7910]OUT-2-D-7-7<br />
            [   6.9690]ARRIVE-A-7-1<br />
            [   7.0080]CLOSE-D-7-7<br />
            [   7.5750]ARRIVE-A-8-1<br />
            [   7.5750]OPEN-A-8-1<br />
            [   7.6250]ARRIVE-D-2-4<br />
            [   7.7820]IN-1-A-8-1<br />
            [   7.9930]CLOSE-A-8-1<br />
            [   8.2390]ARRIVE-D-3-4<br />
            [   8.5990]ARRIVE-A-7-1<br />
            [   8.6010]OPEN-A-7-1<br />
            [   8.8080]OUT-1-A-7-1<br />
            [   8.8570]ARRIVE-D-4-4<br />
            [   9.0210]CLOSE-A-7-1<br />
            [   9.4700]ARRIVE-D-5-4<br />
            [   9.6330]ARRIVE-E-7-7<br />
            [  10.0750]ARRIVE-D-6-4<br />
            [  10.2480]ARRIVE-A-7-7<br />
            [  10.2480]OPEN-A-7-7<br />
            [  10.4560]IN-1-A-7-7<br />
            [  10.6720]CLOSE-A-7-7<br />
            [  10.6900]ARRIVE-D-7-4<br />
            [  10.6910]OPEN-D-7-4<br />
            [  10.9060]IN-2-D-7-4<br />
            [  11.1160]CLOSE-D-7-4<br />
            [  11.2870]ARRIVE-B-7-7<br />
            [  11.7270]ARRIVE-D-8-4<br />
            [  11.7280]OPEN-D-8-4<br />
            [  11.8910]ARRIVE-C-7-7<br />
            [  11.8920]OPEN-C-7-7<br />
            [  11.9410]OUT-2-D-8-4<br />
            [  12.0960]OUT-1-C-7-7<br />
            [  12.1440]CLOSE-D-8-4<br />
            [  12.2990]CLOSE-C-7-7</td>
        <td>两个请求都在 7 楼进行换乘处理</td>
    </tr>
</table>

说明：

- $1、$为了方便说明，指导书上提供的输入为这样的格式：`[x.x]yyyyyyyy`。
- $2、$意思是在 `x.x` 这个时刻（相对于程序运行开始的时间，单位秒），输入 `yyyyyyyy` 这样的一行数据。
- $3、$关于上面说到的时间计测同步性问题，在这里解释一下：
    - $(1)、$直观地说，可能会观察到输入指令时间晚于做出反应的时间或反应时间明显晚于预期时间的现象。
    - $(2)、$这个实际上不是程序的错误，而是由于评测机投放数据的系统、和程序输出接口，这两边的时间可能存在不同步导致的。
    - $(3)、$**这一问题是由于多线程测试不可避免的波动性导致的计时同步性误差，属于正常现象，不会被认定为错误**。（<del>当然，也不会出现故意提早的情况，因为程序本身就是实时交互，不可能做得到预知未来</del>）但是，电梯的操作还是应当遵从逻辑，不能出现乘客先进电梯，再开门这样的操作，**你的程序所输出的操作的时间戳也应当是递增的**。

***

### 第五部分：测试数据限制说明

#### 一、数据基本限制

- $1、$可输入电梯系统的指令数：**1~70条**（指令数为0或超过70均为不合法输入）。
- $2、$系统时间上限 $T_{max}$ ：电梯系统时间 $T_{real}$ 和电梯系统运行花费总时间 $T_{final}$ 的上限时间，**一旦超过将直接判定为TIME_LIMIT_EXCEED**。
- $3、$乘客$id$满足为int类型且 $id>0$
- $4、$**注意**，本次作业**新增电梯与请求之间不存在时间上的限制关系**（显然，所有请求都能够被初始电梯完成）。

#### 二、公测数据限制

- $1、$运行基准时间 $T_{ALS}$：基于 ALS 的纵向横向电梯调度策略运行的时间。
- $2、$系统时间上限 $T_{max}$：计算方式为 $T_{max} = \max\left(T_{ALS}+3, 1.05\cdot T_{ALS}\right)$
- $3、$包括强测在内的数据都会保证正常程序的电梯系统时间不会超过 $T_{max}$，也会**避免使用对边界情况较为敏感的数据**。
- $4、$提示：**对于中测和强测数据，$T_{max}$ 将会严格限制为通过上述公式计算得到的值。**<del>所以，请不要试图用超长的 sleep 来回避线程安全停止的问题。</del>。</del>

#### 三、互测数据限制

- $1、$系统时间上限 $T_{max}$：对于互测数据，$T_{max}$ 为210s。
- $2、$第一条指令的投喂时间在 1s 或 1s 以后。
- $3、$最后一条指令的输入时间不晚于50s。
- $4、$指令条数不超过50。
- $5、$要求每座、每层最多3个电梯，总电梯数量不超过20。

***

### 第六部分：公测说明

#### 一、正确性判断

程序被认定为正确当且仅当以下 3 个条件同时满足：

- $1、$**代码实现中不存在轮询**。轮询是一种非常占用 CPU 资源的行为，为了避免出现轮询的情况，**请使用 Wait-Notify 的方式编程(也可采取 Condition 的 await, signalAll 方式等其他合理方式)**。同时，为了检查是否出现轮询的情况，总 CPU 时间限制为 10s，不满足该限制的程序会被判定为错误。

- $2、$**电梯的性能符合基本要求**，即你的程序需要满足 $T_{real} \le T_{max}\ \&\&\ T_{final} \le T_{max}$。这里再次说明 $T_{max}$ 的标准：

    - $(1)、$对于公测数据，$T_{max}$ 取决于 $T_{ALS}$，计算方式为 $T_{max} = \max\left(T_{ALS}+3, 1.05\cdot T_{ALS}\right)$，基准为 ALS 调度策略。
    - $(2)、$对于互测数据，$T_{max}$ 为210s。

- $3、$**输出结果符合逻辑**，具体来说，有以下几点：

    - $(1)、$电梯运行逻辑合理：

        - $a、$电梯到达一层后就可以输出开门信息，然后花 0.2s 开门，开门结束。
        - $b、$电梯开门结束后，某一刻电梯花 0.2s 关门，然后输出关门信息，就可以离开楼层。
        - $c、$电梯在两楼层间若发生移动，应满足移动时间要求
        - $d、$电梯只在可到达楼层运行。

    - $(2)、$人员进出逻辑合理：

        - $a、$只有已经在电梯里的人可以出电梯，也只有不在电梯里的人可以进入电梯。

        - $b、$如果电梯在楼座 A 楼层 2，那么乘客显然也只能在楼座 A 楼层 2 进出。

        - $c、$**反常识设定**：开门的 0.2s 期间或关门的 0.2s 期间乘客仍然可以进出，即在**整个开关门窗口时间内**乘客都可以进出。~~纸片人没有厚度~~

        - $d、$乘客进出信息在电梯开关门窗口时间之内。

            ```java
            错误示例：
            [   4.6280]OUT-1-A-1 ← 这个人没开门就出来了
            [   4.8440]OPEN-A-1
            [   5.0470]CLOSE-A-1
            ```

        - $e、$ 电梯系统结束运行时，所有的乘客都到达了目标楼层，且没有被困在电梯里。

    - $(3)、$电梯载客量合理：

        -   $a、$**电梯任何时候，内部的人数都必须小于等于轿厢容量限制**。
        -   $b、$也就是说，即便在 OPEN、CLOSE 中间，也不允许出现超过容量限制的中间情况。

    - $(4)、$时间戳合理：即**输出的时间戳应该是非减的**。

#### 二、性能分的评判

在本次作业中，为了更贴近现实的情景，对性能分的评判依据性能值做了修改。性能值将由电梯的总运行时间 $T_1$ 与所有请求总等待时间 $T_2$ 之和 $T$ 计算得出。
请求总等待时间 $T_2$ 的定义为：$\sum_{i \in passagers} (T_{i到达目标楼层}-T_{i发出请求})$，即所有乘客从发出请求到满足请求的总时间。
设某同学给出的正确答案的性能值为 $T_p$，所有人给出的正确答案的性能值的最小值为 $T_{min}$，最大值为 $T_{max}$，平均值为 $T_{avg}$。
设
		$base_{min} = p\cdot T_{avg}+(1-p)\cdot T_{min}$，

​		$base_{max}=p\cdot T_{max}+(1-p)\cdot T_{avg}$，

​		$p=0.25$

则该同学性能分百分比为：
$$
r(T_p)= 100 \% \cdot\begin{cases}1 & T_p \leq base_{min} \\1-10^{1-\frac{base_{max}-base_{min}}{T_p-base_{min}}} & base_{min} < T_p \leq base_{max} \\\ 0 & T_p > base_{max}\end{cases}
$$

#### 三、分数判定和组成

本次作业功能分为 85 分，性能分为 15 分，二者之和为总分。

***

### 第七部分：互测说明

- $1、$**程序在互测中的正确性判断规则与公测说明中的一致。**

- $2、$所有提交的互测数据均需要满足以下输入格式（该格式与样例一致，可参考样例中的输入格式）：

  + $(1)、$需要额外附加时间戳 `[time]`，其中 time 是一个保留一位小数的浮点数，比如 `0.0`,`1.5`,`2.2 `等。

  + $(2)、$每行的输入为乘客请求，其格式为 `[<time>]<id>-FROM-<A>-<x>-TO-<B>-<y>`。

  + $(3)、$评测系统将使用请求发射器在对应的时间将请求送入标准输入。

- $3、$所有提交的互测数据均需要满足数据基本限制和互测数据限制。

- $4、$**随测试点提交的输出**中电梯最终的关门时间 $T_{final}$ 不得大于 150s。

***

### 第八部分：提示和警示

#### 一、提示

- $1、$关于接口的一些使用，可以在 idea 里面，按 Ctrl+Q 。将可以看到类和方法的使用格式以及注释（本次官方提供的接口均提供了中文版 javadoc 注释，Ctrl+Q 可以直接查看）

- $2、$请**在代码一开始就初始化时间戳**，否则可能会出现和评测不一致的情况。

    ```java
    import com.oocourse.TimableOutput;
    
    public class MainClass {
      public static void main(String[] args) {
        TimableOutput.initStartTimestamp();  // 初始化时间戳
    		/*
    			代码部分
    		*/
      }
    }
    ```

* $3、$官方提供的输出包是**线程不安全**的，需要同学们**自行保证其被多个线程调用时输出符合逻辑**。
* $4、$由于**多线程调度存在随机性**，在使用官方提供的投喂脚本或进行互测环节时，可能会出现**输出与官方评测机不一致、bug 无法复现的情况**，最终结果均**以官方评测机为准**。
* $5、$如何进行线程安全设计：
    * 明确共享对象的状态和约束
    * 更高效率的进行并发访问（如使用读写锁）
* $6、$线程协同架构选择：
    * 对请求的处理分段：分配给横/纵向电梯 $\rightarrow$ 分配给哪部电梯
    * 对共享队列的选择：整体队列、楼座（层）队列、电梯队列
* $7、$工厂模式的使用：采用工厂模式来创建不同运行模式、运行策略的电梯。
* $8、$换乘问题：
    * 必须要换乘：如何判断路径可达？
    * 可能要换乘：如何估计换乘代价？估计过程是否需要加锁？
* $9、$不可直达请求：
    * 动态拆分：电梯分析整体的请求，尽量将请求往目的地捎带？
    * 静态拆分：跟据路径可达信息在请求读入时拆成多个阶段任务，电梯按阶段接受任务？

#### 二、警示

<font color = red>不要试图Hack评测机和官方接口，不要企图伪造时间戳，不要抄袭。如在互测中发现其他人的代码疑似存在上述行为，可向课程组举报。课程组感谢同学们为OO课程建设所作出的贡献。</font>

#### 三、掩码

本次作业中的可到达信息 $M$ 主要采用了掩码 (mask) 来表示，下面进行一个简单的举例：

如果我们要表示物品是易燃还是易爆，那么可以采取如下方式：

* 我们用二进制第 1 位（即最低位）的 `0 / 1` 来表示 `不易燃 / 易燃` 
* 我们用二进制第 2 位的 `0 / 1` 来表示 `不易爆 / 易爆`

这样的话，我们只需要两位就能表示出所有的情况：

* 0 (二进制 00) 代表不易燃且不易爆
* 1 (二进制 01) 代表易燃但是不易爆
* 2 (二进制 10) 代表易爆但是不易燃
* 3 (二进制 11) 代表易燃且易爆

需要得到这个物品的情况时就取出其对应位即可。

当然，如果理解不了也不影响我们作业的完成，只需要使用给定的公式就可以了。
